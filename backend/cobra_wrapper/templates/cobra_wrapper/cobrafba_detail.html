{% extends 'base.html' %}

{% load cobra_wrapper_tags %}
{% load mathfilters %}

{% block title %}FBA Result of {{ object }}{% endblock title %}


{% block content %}
    <table>
        <tr>
            <td>id</td>
            <td>{{ object.id }}</td>
        </tr>
        <tr>
            <td>description</td>
            <td>{{ object.desc }}</td>
        </tr>
        <tr>
            <td>start_time</td>
            <td>{{ object.start_time }}</td>
        </tr>
        <tr>
            <td>model</td>
            <td><a href="{% url 'cobra_wrapper:cobramodel_detail' model_pk %}">{{ object.model }}</a></td>
        </tr>
    </table>

    <p>Status: {{ object|check_result_status }}</p>

    {% if result %}
        {% if result.ok %}
            <table>
                <tr>
                    <th>objective_value</th>
                    <th>status</th>
                </tr>
                <tr>
                    <td>{{ result.objective_value }}</td>
                    <td>{{ result.status }}</td>
                </tr>
            </table>

            <table>
                <thead>
                <tr>
                    <th>fluxes</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th>name</th>
                    <th>value</th>
                </tr>
                {% for name, value in result.fluxes.items %}
                    <tr>
                        <td>{{ name }}</td>
                        <td>{{ value }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

            <table>
                <thead>
                <tr>
                    <th>shadow_price</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th>name</th>
                    <th>value</th>
                </tr>
                {% for name, value in result.shadow_prices.items %}
                    <tr>
                        <td>{{ name }}</td>
                        <td>{{ value }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            {{ result }}
        {% endif %}
    {% endif %}

    <table>
        <tr>
            <th>id</th>
            <th>Current</th>
            {% for fba in latest_fba_list %}
                {% if fba.ok %}
                    <th>{{ fba.id }}</th>
                {% endif %}
            {% endfor %}
        </tr>
        <tr>
            <td>Objective_value_change</td>
            <td>{{ result.objective_value }}</td>
            {% for fba in latest_fba_list %}
                {% if fba.ok %}
                    <td>{{ result.objective_value }}({{ result.objective_value|sub:fba.objective_value }})</td>
                {% endif %}
            {% endfor %}
        </tr>
        <tr>
            <td>Fluxes_name</td>
        </tr>
        {% for name, value in result.fluxes.items %}
            <tr>
                <td>{{ name }}</td>
                <td>{{ value }}</td>
                {% for fba in latest_fba_list %}
                    {% if fba.ok %}
                        {% if name in fba.fluxes.index %}
                            <td>{{ fba.fluxes|getattr_template:name }}({{ value|sub:fba.fluxes|getattr_template:name }})</td>
                        {% else %}
                            <td>None</td>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </tr>
        {% endfor %}

    </table>

    <a href="{% url 'cobra_wrapper:cobrafba_confirm_delete' model_pk object.pk %}">Delete</a>
    <a href="{% url 'cobra_wrapper:cobrafba_list' model_pk %}">Return</a>
{% endblock content %}